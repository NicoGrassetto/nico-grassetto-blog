---
export interface Props {
  type: 'line' | 'bar' | 'pie' | 'doughnut' | 'scatter' | 'bubble' | 'polarArea' | 'radar';
  data: any;
  options?: any;
  width?: number;
  height?: number;
  id?: string;
}

const { 
  type = 'line', 
  data, 
  options = {}, 
  width = 400, 
  height = 300,
  id = 'chart-' + Math.random().toString(36).substr(2, 9)
} = Astro.props;

// Default responsive options
const defaultOptions = {
  responsive: true,
  maintainAspectRatio: false,
  plugins: {
    title: {
      display: !!options.title,
      text: options.title
    },
    legend: {
      display: true,
      position: 'top'
    }
  },
  ...options
};
---

<div class="chart-container" style={`width: ${width}px; height: ${height}px; margin: 1rem auto;`}>
  <canvas id={id} width={width} height={height}></canvas>
</div>

<script define:vars={{ type, data, options: defaultOptions, id }}>
  // Wait for Chart.js to be available
  function initChart() {
    if (typeof Chart !== 'undefined') {
      const ctx = document.getElementById(id);
      if (ctx) {
        try {
          new Chart(ctx, {
            type: type,
            data: data,
            options: options
          });
          console.log('Chart rendered successfully:', id);
        } catch (error) {
          console.error('Chart rendering error:', error);
          console.log('Chart data:', data);
          console.log('Chart type:', type);
        }
      } else {
        console.error('Canvas element not found:', id);
      }
    } else {
      // Chart.js not loaded yet, wait a bit and try again
      setTimeout(initChart, 100);
    }
  }
  
  // Start initialization when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initChart);
  } else {
    initChart();
  }
</script>

<style>
  .chart-container {
    background: white;
    border-radius: 8px;
    padding: 1rem;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    display: flex;
    justify-content: center;
    align-items: center;
  }
  
  canvas {
    max-width: 100%;
    height: auto;
  }
  
  @media (max-width: 768px) {
    .chart-container {
      width: 100% !important;
      max-width: 100%;
    }
  }
</style>
